// BP3 Grammar: ruwet.bp
// Generated by bp2sc from: ruwet.bp
// Bol Processor BP3 â†’ SuperCollider Pattern transpiler
//
// Usage:
//   1. Boot the server: s.boot;
//   2. Execute this file: Ctrl+Enter (select all)
//   3. To stop: Cmd+. or Ctrl+.
//   4. Morph live: re-evaluate individual Pdef blocks

(

// Default SynthDef for testing (replace with your own)
SynthDef(\bp2sc_default, {
    |out=0, freq=440, amp=0.1, gate=1, pan=0|
    var sig, env;
    env = EnvGen.kr(Env.adsr(0.01, 0.1, 0.6, 0.3), gate, doneAction: 2);
    sig = SinOsc.ar(freq) + Pulse.ar(freq * 1.001, 0.3, 0.3);
    sig = LPF.ar(sig, freq * 4);
    Out.ar(out, Pan2.ar(sig * env * amp, pan));
}).add;


// Bol Processor BP3 compatible with version BP2.9.8
// Grammar file saved as "-gr.Ruwet". Date: 2020-10-31 17:03:39
// BP3 reference: -ho.Ruwet
// BP3 reference: -se.Ruwet
// This model of theme-and-variation was inspired by an analysis by musicologist Nicolas Ruwet. It was done by a student of mine using a very old version of BP2. I have "recycled" it recently. Suggestions are welcome.
// Variables starting with low-case characters are delimited with | | to avoid any confusion with terminal symbols.
// Note that the alphabet is defining three homomorphisms: "m1", "m2", "mineur". Only "mineur" is used in this example.

// --- Subgrammar 1 (ORD) ---

Pdef(\S,
	Pseq([Pdef(\P1), Pdef(\P2), Pdef(\P3)], 1)
);


Pdef(\P1,
	Pseq([Pdef(\A8), Pdef(\B_q8), Pdef(\C8), Pdef(\B_p8)], 1)
);


Pdef(\P2,
	Pseq([Pdef(\A8), Pdef(\B8), Pdef(\C8), Pdef(\B8)], 1)
);


Pdef(\P3,
	Pseq([Pdef(\C_p8), Pdef(\B_p8), Pdef(\C_p8), Pdef(\B_p8)], 1)
);


Pdef(\A8,
	Pseq([Pdef(\a4), Pdef(\b4)], 1)
);


Pdef(\B_q8,
	Pseq([Pdef(\c_q4), Pdef(\f4)], 1)
);


Pdef(\B8,
	Pseq([Pdef(\c4), Pdef(\f4)], 1)
);


Pdef(\B_p8,
	Pseq([Pdef(\c_p4), Pdef(\f4)], 1)
);


Pdef(\C8,
	Pseq([Pdef(\d4), Pdef(\e4)], 1)
);


Pdef(\C_p8,
	Pseq([Pdef(\e4), Pdef(\e4)], 1)
);



// --- Subgrammar 2 (LIN) ---

Pdef(\a4,
	Pseq([Pdef(\x), Pdef(\z31_g3)], 1)
);


Pdef(\b4,
	Pseq([Pdef(\y_g3), Pdef(\z5)], 1)
);


Pdef(\c4,
	Pseq([Pdef(\w), Pdef(\z31_g3)], 1)
);


Pdef(\c_q4,
	Pseq([Pdef(\w), Pdef(\z311_g3)], 1)
);


Pdef(\c_p4,
	Pseq([Pdef(\w), Pdef(\z3)], 1)
);


Pdef(\d4,
	Pseq([Pdef(\miny), Pdef(\z32_g3)], 1)
);


Pdef(\e4,
	Pseq([Pdef(\y1), Pdef(\z31_g3)], 1)
);


Pdef(\f4,
	Pseq([Pdef(\o), Pdef(\z1)], 1)
);



// --- Subgrammar 3 (LIN) ---

Pdef(\x,
	Pwrand([Pbind(
		\midinote, Pseq([65, 72], 1),
		\dur, 0.25
	), Pdef(\x1), Pdef(\x2), Pdef(\x3), Pdef(\x4)], [4, 1, 1, 1, 1].normalizeSum, 1)
);


Pdef(\y_g3,
	Prand([Pbind(
		\midinote, Pseq([65, 69], 1),
		\dur, 0.25
	), Pdef(\y1), Pdef(\y2), Pdef(\y3), Pdef(\y4), Pdef(\y5), Pdef(\y6), Pdef(\y7), Pdef(\y8)], 1)
);


Pdef(\w,
	Prand([Pbind(
		\midinote, Pseq([69, 72], 1),
		\dur, 0.25
	), Pdef(\w1), Pdef(\w2), Pdef(\w3), Pdef(\w4), Pdef(\w5)], 1)
);


Pdef(\z1,
	Pwrand([Pbind(
		\midinote, Pseq([65, 65], 1),
		\dur, 0.25
	), Pdef(\z12), Pdef(\z13)], [4, 1, 1].normalizeSum, 1)
);


Pdef(\z3,
	Prand([Pbind(
		\midinote, Pseq([69, 69], 1),
		\dur, 0.25
	), Pdef(\z31_g3), Pdef(\z311_g3), Pdef(\z32_g3), Pdef(\z321), Pdef(\z33), Pdef(\z34), Pdef(\z35), Pdef(\z36)], 1)
);


Pdef(\z5,
	Prand([Pbind(
		\midinote, Pseq([72, 72], 1),
		\dur, 0.25
	), Pdef(\z51), Pdef(\z511), Pdef(\z52), Pdef(\z521), Pdef(\z53), Pdef(\z54), Pdef(\z55), Pdef(\z56), Pdef(\z57)], 1)
);


Pdef(\z31_g3,
	Pbind(
		\midinote, Pseq([70, 69], 1),
		\dur, 0.25
	)
);


Pdef(\z32_g3,
	Pbind(
		\midinote, Pseq([67, 69], 1),
		\dur, 0.25
	)
);


Pdef(\z311_g3,
	Pbind(
		\midinote, Pseq([70, Pbindf(Pbind(
			\midinote, Pseq([69, 69], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


Pdef(\o,
	Pwrand([Pbind(
		\midinote, Pseq([70, Pbindf(Pbind(
			\midinote, Pseq([69, 67], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	), Pdef(\o1), Pdef(\o2), Pdef(\o3)], [3, 1, 1, 1].normalizeSum, 1)
);



// --- Subgrammar 4 (ORD) ---

Pdef(\x1,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([65, 69], 1),
			\dur, 0.25
		), \stretch, 1/2), 72], 1),
		\dur, 0.25
	)
);


Pdef(\x2,
	Pbind(
		\midinote, Pseq([65, Pbindf(Pbind(
			\midinote, Pseq([69, 72], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // ?
Pdef(\x3,
	Pbindf(Pbind(
		\midinote, Pseq([65, 67, 69, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ?
Pdef(\x4,
	Pbindf(Pbind(
		\midinote, Pseq([65, 69, 70, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


Pdef(\y1,
	Pbind(
		\midinote, Pseq([65, Pbindf(Pbind(
			\midinote, Pseq([67, 69], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // Variant bug fixed here
Pdef(\y2,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([65, 67], 1),
			\dur, 0.25
		), \stretch, 1/2), 69], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\y3,
	Pbind(
		\midinote, Pseq([65, Pbindf(Pbind(
			\midinote, Pseq([69, 70], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // ? Variant
Pdef(\y4,
	Pbindf(Pbind(
		\midinote, Pseq([65, 67, 69, 70], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\y5,
	Pbindf(Pbind(
		\midinote, Pseq([65, 69, 67, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\y6,
	Pbindf(Pbind(
		\midinote, Pseq([65, 67, 70, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\y7,
	Pbindf(Pbind(
		\midinote, Pseq([65, 69, 70, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\y8,
	Pbindf(Pbind(
		\midinote, Pseq([65, 67, 65, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Variant
Pdef(\w1,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([69, 70], 1),
			\dur, 0.25
		), \stretch, 1/2), 72], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\w2,
	Pbind(
		\midinote, Pseq([69, Pbindf(Pbind(
			\midinote, Pseq([70, 72], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // ? Variant
Pdef(\w3,
	Pbindf(Pbind(
		\midinote, Pseq([69, 70, 72, 70], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\w4,
	Pbindf(Pbind(
		\midinote, Pseq([69, 67, 69, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // ? Variant
Pdef(\w5,
	Pbindf(Pbind(
		\midinote, Pseq([69, 70, 69, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Not relevant
Pdef(\z11,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([65, 64], 1),
			\dur, 0.25
		), \stretch, 1/2), 65], 1),
		\dur, 0.25
	)
);


Pdef(\z12,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([65, 67], 1),
			\dur, 0.25
		), \stretch, 1/2), 65], 1),
		\dur, 0.25
	)
);


  // |z13| is used as context in the preceding grammar
Pdef(\z13,
	Pbind(
		\midinote, Pseq([67, 65], 1),
		\dur, 0.25
	)
);


  // Not relevant
Pdef(\z14,
	Pbind(
		\midinote, Pseq([64, 65], 1),
		\dur, 0.25
	)
);


Pdef(\z31_g4,
	Pbind(
		\midinote, Pseq([70, 69], 1),
		\dur, 0.25
	)
);


Pdef(\z311_g4,
	Pbind(
		\midinote, Pseq([70, Pbindf(Pbind(
			\midinote, Pseq([69, 69], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z32_g4,
	Pbind(
		\midinote, Pseq([67, 69], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z321,
	Pbind(
		\midinote, Pseq([67, Pbindf(Pbind(
			\midinote, Pseq([69, 69], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z33,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([69, 67], 1),
			\dur, 0.25
		), \stretch, 1/2), 69], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z34,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([69, 70], 1),
			\dur, 0.25
		), \stretch, 1/2), 69], 1),
		\dur, 0.25
	)
);


  // Variant ?
Pdef(\z35,
	Pbindf(Pbind(
		\midinote, Pseq([69, 67, 70, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Variant ?
Pdef(\z36,
	Pbindf(Pbind(
		\midinote, Pseq([70, 69, 67, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Variant
Pdef(\z51,
	Pbind(
		\midinote, Pseq([74, 72], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z511,
	Pbind(
		\midinote, Pseq([74, Pbindf(Pbind(
			\midinote, Pseq([72, 72], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z52,
	Pbind(
		\midinote, Pseq([70, 72], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z521,
	Pbind(
		\midinote, Pseq([70, Pbindf(Pbind(
			\midinote, Pseq([72, 72], 1),
			\dur, 0.25
		), \stretch, 1/2)], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z53,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([72, 70], 1),
			\dur, 0.25
		), \stretch, 1/2), 72], 1),
		\dur, 0.25
	)
);


  // Variant
Pdef(\z54,
	Pbind(
		\midinote, Pseq([Pbindf(Pbind(
			\midinote, Pseq([72, 74], 1),
			\dur, 0.25
		), \stretch, 1/2), 72], 1),
		\dur, 0.25
	)
);


  // Variant ?
Pdef(\z55,
	Pbindf(Pbind(
		\midinote, Pseq([72, 70, 74, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Variant ?
Pdef(\z56,
	Pbindf(Pbind(
		\midinote, Pseq([74, 72, 70, 72], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


  // Variant ?
Pdef(\z57,
	Pbindf(Pbind(
		\midinote, Pseq([72, 74, 72, 70], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


Pdef(\o1,
	Pbindf(Pbind(
		\midinote, Pseq([72, 70, 69, 67], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


Pdef(\o2,
	Pbindf(Pbind(
		\midinote, Pseq([70, 70, 69, 67], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


Pdef(\o3,
	Pbindf(Pbind(
		\midinote, Pseq([70, 72, 70, 69], 1),
		\dur, 0.25
	), \stretch, 2/4)
);


Pdef(\miny,
	Pdef(\y_g3)
);



// --- Subgrammar 5 (ORD) ---

Pdef(\y_g5,
	Pbind(
		\midinote, Pseq([65, 69], 1),
		\dur, 0.25
	)
);



// --- Play ---
Pdef(\S).play;

)
